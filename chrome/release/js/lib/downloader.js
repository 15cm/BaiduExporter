!function(){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var e=function(){function e(){n(this,e),this._listeners={}}return a(e,[{key:"on",value:function(e,t){(this._listeners[e]=this._listeners[e]||[]).push(t)}},{key:"trigger",value:function(e,t){(this._listeners[e]||[]).forEach(function(e){return e(t)})}},{key:"off",value:function(e){delete this._listeners[e]}}]),e}(),u=new(function(){function t(){var e;return n(this,t),(e=function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?s(e):t}(this,i(t).call(this))).defaultRPC=[{name:"ARIA2 RPC",url:"http://localhost:6800/jsonrpc"}],e.defaultUserAgent="netdisk;6.0.0.12;PC;PC-Windows;10.0.16299;WindowsBaiduYunGuanJia",e.defaultReferer="https://pan.baidu.com/disk/home",e.defaultAppId=250528,e.defaultConfigData={rpcList:e.defaultRPC,configSync:!1,md5Check:!1,fold:0,interval:300,downloadPath:"",userAgent:e.defaultUserAgent,referer:e.defaultReferer,appId:e.defaultAppId,headers:""},e.configData={},e.on("initConfigData",e.init.bind(s(e))),e.on("setConfigData",e.set.bind(s(e))),e.on("clearConfigData",e.clear.bind(s(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),a(t,[{key:"init",value:function(){var t=this;chrome.storage.sync.get(null,function(t){function e(e){chrome.storage.local.set({key:t[e]},function(){console.log("chrome first local set: %s, %s",e,t[e])})}for(var n in t)e(n)}),chrome.storage.local.get(null,function(e){t.configData=Object.assign({},t.defaultConfigData,e),t.trigger("updateView",t.configData)})}},{key:"getConfigData",value:function(e){var t=0<arguments.length&&void 0!==e?e:null;return t?this.configData[t]:this.configData}},{key:"set",value:function(e){this.configData=e,this.save(e),this.trigger("updateView",e)}},{key:"save",value:function(t){function e(e){chrome.storage.local.set(r({},e,t[e]),function(){console.log("chrome local set: %s, %s",e,t[e])}),!0===t.configSync&&chrome.storage.sync.set(r({},e,t[e]),function(){console.log("chrome sync set: %s, %s",e,t[e])})}for(var n in t)e(n)}},{key:"clear",value:function(){chrome.storage.sync.clear(),chrome.storage.local.clear(),this.configData=this.defaultConfigData,this.trigger("updateView",this.configData)}}]),t}()),t=new(function(){function e(){n(this,e),this.cookies={}}return a(e,[{key:"httpSend",value:function(e,t,n){var o=e.url,a=e.options;fetch(o,a).then(function(e){e.ok?e.json().then(function(e){t(e)}):n(e)}).catch(function(e){n(e)})}},{key:"getConfigData",value:function(e){var t=0<arguments.length&&void 0!==e?e:null;return u.getConfigData(t)}},{key:"objectToQueryString",value:function(t){return Object.keys(t).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t[e]))}).join("&")}},{key:"sendToBackground",value:function(e,t,n){chrome.runtime.sendMessage({method:e,data:t},n)}},{key:"showToast",value:function(e,t){window.postMessage({type:"showToast",data:{message:e,type:t}},location.origin)}},{key:"getHashParameter",value:function(e){var t=window.location.hash.substr(1);return new URLSearchParams(t).get(e)}},{key:"formatCookies",value:function(){var e=[];for(var t in this.cookies)e.push("".concat(t,"=").concat(this.cookies[t]));return e.join("; ")}},{key:"getHeader",value:function(e){var t=0<arguments.length&&void 0!==e?e:"RPC",n=[];n.push("User-Agent: ".concat(this.getConfigData("userAgent"))),n.push("Referer: ".concat(this.getConfigData("referer"))),0<Object.keys(this.cookies).length&&n.push("Cookie: ".concat(this.formatCookies()));var o=this.getConfigData("headers");return o&&o.split("\n").forEach(function(e){n.push(e)}),"RPC"===t?n:"aria2Cmd"===t?n.map(function(e){return"--header ".concat(JSON.stringify(e))}).join(" "):"aria2c"===t?n.map(function(e){return" header=".concat(e)}).join("\n"):"idm"===t?n.map(function(e){var t=e.split(": ");return"".concat(t[0].toLowerCase(),": ").concat(t[1])}).join("\r\n"):void 0}},{key:"parseURL",value:function(e){var t=new URL(e),n=t.username?"".concat(t.username,":").concat(decodeURI(t.password)):null;n&&(n.includes("token:")||(n="Basic ".concat(btoa(n))));var o=t.hash.substr(1),a={},r=new URLSearchParams(o),i=!0,c=!1,s=void 0;try{for(var u,f=r[Symbol.iterator]();!(i=(u=f.next()).done);i=!0){var l=u.value;a[l[0]]=2===l.length?l[1]:"enabled"}}catch(e){c=!0,s=e}finally{try{i||null==f.return||f.return()}finally{if(c)throw s}}return{authStr:n,path:t.origin+t.pathname,options:a}}},{key:"generateParameter",value:function(e,t,n){e&&e.startsWith("token")&&n.params.unshift(e);var o={url:t,options:{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:JSON.stringify(n)}};return e&&e.startsWith("Basic")&&(o.options.headers.Authorization=e),o}},{key:"getVersion",value:function(e,t){var n=this.parseURL(e),o=n.authStr,a=n.path;this.sendToBackground("rpcVersion",this.generateParameter(o,a,{jsonrpc:"2.0",method:"aria2.getVersion",id:1,params:[]}),function(e){t.innerText=e?"Aria2版本为: ".concat(e):"错误,请查看是否开启Aria2"})}},{key:"copyText",value:function(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.focus(),t.select();var n=document.execCommand("copy");t.remove(),n?this.showToast("拷贝成功~","success"):this.showToast("拷贝失败 QAQ","failure")}},{key:"requestCookies",value:function(e){var t=this;this.sendToBackground("getCookies",e,function(e){t.cookies=e})}},{key:"aria2RPCMode",value:function(e,t){var i=this,n=this.parseURL(e),c=n.authStr,s=n.path,u=n.options;t.forEach(function(e){var t={jsonrpc:"2.0",method:"aria2.addUri",id:(new Date).getTime(),params:[[e.link],{out:e.name,header:i.getHeader()}]},n=i.getConfigData("md5Check"),o=t.params[1],a=i.getConfigData("downloadPath");if(a&&(o.dir=a),n&&(o.checksum="md5=".concat(e.md5)),u)for(var r in u)o[r]=u[r];i.sendToBackground("rpcData",i.generateParameter(c,s,t),function(e){e?i.showToast("下载成功!赶紧去看看吧~","success"):i.showToast("下载失败!是不是没有开启Aria2?","failure")})})}},{key:"aria2TXTMode",value:function(e){var a=this,r=[],i=[],c=[],s=[],t="data:text/plain;charset=utf-8,";e.forEach(function(e){var t="aria2c -c -s10 -k1M -x16 --enable-rpc=false -o ".concat(JSON.stringify(e.name)," ").concat(a.getHeader("aria2Cmd")," ").concat(JSON.stringify(e.link)),n=[e.link,a.getHeader("aria2c")," out=".concat(e.name)].join("\n");a.getConfigData("md5Check")&&(t+=" --checksum=md5=".concat(e.md5),n+="\n checksum=md5=".concat(e.md5)),r.push(t),i.push(n);var o=["<",e.link,a.getHeader("idm"),">"].join("\r\n");c.push(o),s.push(e.link)}),document.querySelector("#aria2CmdTxt").value="".concat(r.join("\n")),document.querySelector("#aria2Txt").href="".concat(t).concat(encodeURIComponent(i.join("\n"))),document.querySelector("#idmTxt").href="".concat(t).concat(encodeURIComponent(c.join("\r\n")+"\r\n")),document.querySelector("#downloadLinkTxt").href="".concat(t).concat(encodeURIComponent(s.join("\n"))),document.querySelector("#copyDownloadLinkTxt").dataset.link=s.join("\n")}}]),e}())}();